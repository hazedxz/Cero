<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CERO | GitHub Style</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gh-bg: #0d1117;
            --gh-border: #30363d;
            --gh-card: #161b22;
            --gh-text: #c9d1d9;
            --gh-blue: #58a6ff;
            --gh-success: #238636;
            --gh-danger: #f85149;
        }

        body {
            background-color: var(--gh-bg);
            color: var(--gh-text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            width: 100%;
            background-color: #010409;
            border-bottom: 1px solid var(--gh-border);
            padding: 16px 0;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        h1 { font-size: 1.2rem; font-weight: 600; margin: 0; }

        #main-container { width: 95%; max-width: 800px; margin-top: 24px; }

        /* Estilo de la Caja de Publicaci√≥n (Estilo Issue de GitHub) */
        .input-box {
            background: var(--gh-card);
            border: 1px solid var(--gh-border);
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 24px;
        }

        textarea {
            width: 100%;
            background: var(--gh-bg);
            border: 1px solid var(--gh-border);
            border-radius: 6px;
            color: white;
            padding: 12px;
            resize: none;
            box-sizing: border-box;
            font-size: 14px;
        }

        .input-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }

        button {
            border-radius: 6px;
            padding: 5px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid rgba(240,246,252,0.1);
            transition: 0.2s;
        }

        .btn-primary { background: var(--gh-success); color: white; }
        .btn-primary:hover { background: #2ea043; }

        /* Feed de Publicaciones */
        .post {
            background: var(--gh-card);
            border: 1px solid var(--gh-border);
            border-radius: 6px;
            margin-bottom: 16px;
            animation: fadeIn 0.3s ease;
        }

        .post-header {
            padding: 12px;
            background: #1c2128;
            border-bottom: 1px solid var(--gh-border);
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }

        .post-body { padding: 16px; font-size: 14px; line-height: 1.5; }
        .post-gif { width: 100%; max-height: 400px; object-fit: contain; margin-top: 10px; border-radius: 6px; }

        .post-footer {
            padding: 8px 12px;
            display: flex;
            gap: 12px;
            border-top: 1px solid var(--gh-border);
        }

        .action-link {
            color: #8b949e;
            text-decoration: none;
            font-size: 12px;
            cursor: pointer;
            background: none;
            border: none;
        }

        .action-link:hover { color: var(--gh-blue); }

        /* Comentarios */
        .comments-area {
            background: #0d1117;
            padding: 12px;
            display: none;
            border-top: 1px solid var(--gh-border);
        }

        .comment { font-size: 13px; margin-bottom: 8px; border-bottom: 1px solid #21262d; padding-bottom: 4px; }
        .comment b { color: var(--gh-blue); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header><h1>CERO / Community</h1></header>

<div id="main-container">
    <div class="input-box">
        <textarea id="postText" placeholder="Escribe un nuevo chisme o debate..."></textarea>
        <input type="text" id="postGif" placeholder="URL del GIF (ej. https://media.giphy.com/...)" 
               style="width: 100%; margin-top: 8px; background: var(--gh-bg); border: 1px solid var(--gh-border); color: white; padding: 8px; border-radius: 6px;">
        <div class="input-footer">
            <span style="font-size: 12px; color: #8b949e;">Markdown soportado</span>
            <button class="btn-primary" onclick="enviarPost()">Publicar</button>
        </div>
    </div>

    <div id="feed"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBqWmGTsmfFJSy9x5ld9Rb5u9GEBBKF2FE",
      authDomain: "venepop-b642b.firebaseapp.com",
      databaseURL: "https://venepop-b642b-default-rtdb.firebaseio.com/",
      projectId: "venepop-b642b",
      storageBucket: "venepop-b642b.firebasestorage.app",
      messagingSenderId: "257279813856",
      appId: "1:257279813856:web:32733306545744437e8885"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    async function enviarPost() {
        const texto = document.getElementById('postText').value;
        const gif = document.getElementById('postGif').value;
        if(!texto && !gif) return;

        await db.ref('posts').push({
            texto, gif, likes: 0, fecha: Date.now()
        });
        document.getElementById('postText').value = "";
        document.getElementById('postGif').value = "";
    }

    function toggleComments(id) {
        const el = document.getElementById(`comments-${id}`);
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    async function comentar(e, id) {
        if(e.key === 'Enter' && e.target.value !== "") {
            await db.ref(`posts/${id}/comentarios`).push({ texto: e.target.value });
            e.target.value = "";
        }
    }

    function eliminar(id) {
        if(confirm("¬øSeguro que quieres borrarlo?")) db.ref(`posts/${id}`).remove();
    }

    function like(id) {
        if(localStorage.getItem('liked_'+id)) return;
        db.ref(`posts/${id}/likes`).transaction(l => (l || 0) + 1);
        localStorage.setItem('liked_'+id, true);
    }

    db.ref('posts').on('value', snap => {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        let posts = [];
        snap.forEach(child => { posts.push({id: child.key, ...child.val()}) });

        posts.reverse().forEach(p => {
            let comsHtml = "";
            if(p.comentarios) {
                Object.values(p.comentarios).forEach(c => {
                    comsHtml += `<div class="comment"><b>@anon</b> ${c.texto}</div>`;
                });
            }

            feed.insertAdjacentHTML('beforeend', `
                <div class="post">
                    <div class="post-header">
                        <span><b>anon</b> coment√≥ hace un momento</span>
                        <button class="action-link" onclick="eliminar('${p.id}')" style="color:var(--gh-danger)">Eliminar</button>
                    </div>
                    <div class="post-body">
                        ${p.texto}
                        ${p.gif ? `<img src="${p.gif}" class="post-gif">` : ''}
                    </div>
                    <div class="post-footer">
                        <button class="action-link" onclick="like('${p.id}')">üëç ${p.likes || 0}</button>
                        <button class="action-link" onclick="toggleComments('${p.id}')">üí¨ Debate</button>
                    </div>
                    <div class="comments-area" id="comments-${p.id}">
                        ${comsHtml}
                        <input type="text" class="comment-input" placeholder="Escribe un comentario..." 
                               onkeypress="comentar(event, '${p.id}')" 
                               style="width:100%; background:transparent; border:1px solid var(--gh-border); color:white; padding:4px; margin-top:8px; border-radius:4px; font-size:12px;">
                    </div>
                </div>
            `);
        });
    });
</script>
</body>
</html>